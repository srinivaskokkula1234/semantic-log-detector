<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semantic Log Detector</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Palette: Dark Matter & Amber */
            --bg-primary: #121212;
            --bg-secondary: #1a1a1a;
            --bg-card: rgba(30, 30, 30, 0.7);
            --accent: #FFC107;
            /* Amber Gold */
            --accent-secondary: #FF5722;
            /* Deep Orange */
            --success: #00E676;
            --warning: #FFD600;
            --danger: #FF1744;
            --text-primary: #E0E0E0;
            --text-secondary: #9E9E9E;
            --border: rgba(255, 255, 255, 0.08);
            --glass: rgba(255, 255, 255, 0.03);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(255, 193, 7, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(255, 87, 34, 0.05) 0%, transparent 40%);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: rgba(20, 20, 20, 0.9);
            backdrop-filter: blur(20px);
            padding: 24px;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 50px;
            padding-left: 8px;
        }

        .logo-icon {
            width: 42px;
            height: 42px;
            background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.2);
            font-size: 20px;
            color: #000;
        }

        .logo h1 {
            font-size: 18px;
            font-weight: 700;
            line-height: 1.2;
            letter-spacing: -0.02em;
        }

        .nav-item {
            padding: 14px 18px;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 14px;
            color: var(--text-secondary);
            font-weight: 500;
            border: 1px solid transparent;
        }

        .nav-item:hover {
            background: var(--glass);
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .nav-item.active {
            background: rgba(0, 242, 255, 0.1);
            color: var(--accent);
            border-color: rgba(0, 242, 255, 0.2);
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.05);
        }

        .main-content {
            padding: 40px;
            overflow-y: auto;
            position: relative;
        }

        .view-section {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .view-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .header h2 {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.02em;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(5, 5, 16, 0.5);
            border: 1px solid var(--border);
        }

        .status-badge.online {
            color: var(--success);
            border-color: rgba(0, 255, 157, 0.2);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            box-shadow: 0 0 10px currentColor;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            padding: 24px;
            border-radius: 20px;
            border: 1px solid var(--border);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .stat-card h3 {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .stat-value.accent {
            color: var(--accent);
        }

        .stat-value.danger {
            color: var(--danger);
            text-shadow: 0 0 15px rgba(255, 0, 85, 0.4);
        }

        .stat-value.success {
            color: var(--success);
            text-shadow: 0 0 15px rgba(0, 255, 157, 0.4);
        }

        .stat-value.warning {
            color: var(--warning);
        }

        .card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid var(--border);
            margin-bottom: 24px;
            overflow: hidden;
        }

        .card-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-body {
            padding: 24px;
        }

        .log-input {
            width: 100%;
            padding: 20px;
            background: rgba(5, 5, 16, 0.6);
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text-primary);
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            min-height: 120px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .log-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.1);
        }

        .btn {
            padding: 14px 32px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 15px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
            color: white;
            box-shadow: 0 4px 20px rgba(189, 0, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(189, 0, 255, 0.4);
        }

        .result-card {
            background: rgba(5, 5, 16, 0.4);
            border-radius: 16px;
            padding: 24px;
            margin-top: 24px;
            border-left: 4px solid transparent;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .anomaly-critical {
            border-color: var(--danger);
            background: linear-gradient(90deg, rgba(255, 0, 85, 0.05), transparent);
        }

        .anomaly-high {
            border-color: var(--warning);
            background: linear-gradient(90deg, rgba(255, 184, 0, 0.05), transparent);
        }

        .anomaly-low {
            border-color: var(--success);
            background: linear-gradient(90deg, rgba(0, 255, 157, 0.05), transparent);
        }

        .score-display {
            font-size: 56px;
            font-weight: 700;
            margin: 10px 0 20px;
            letter-spacing: -0.03em;
        }

        .alert-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .alert-table th {
            padding: 16px 24px;
            text-align: left;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .alert-table td {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .alert-table tr:hover td {
            background: rgba(255, 255, 255, 0.02);
        }

        .severity-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.03em;
            text-transform: uppercase;
        }

        .severity-critical {
            background: rgba(255, 0, 85, 0.2);
            color: var(--danger);
        }

        .severity-high {
            background: rgba(255, 184, 0, 0.2);
            color: var(--warning);
        }

        .severity-low {
            background: rgba(0, 255, 157, 0.2);
            color: var(--success);
        }

        .chart-placeholder {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            border: 2px dashed var(--border);
            border-radius: 12px;
            margin: 20px 0;
        }

        /* New Styles for Analytics & Settings */
        .analytics-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        .settings-form {
            display: grid;
            gap: 24px;
            max-width: 600px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 14px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
        }

        .loading {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="dashboard">
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">‚ö°</div>
                <h1>Semantic<br>Log Detector</h1>
            </div>
            <nav id="nav-menu">
                <div class="nav-item active" data-tab="dashboard">
                    <span>üìä</span> Dashboard
                </div>
                <div class="nav-item" data-tab="alerts">
                    <span>üö®</span> Alerts
                </div>
                <div class="nav-item" data-tab="analytics">
                    <span>üìà</span> Analytics
                </div>
                <div class="nav-item" data-tab="settings">
                    <span>‚öôÔ∏è</span> Settings
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <div class="header">
                <h2 id="page-title">Security Overview</h2>
                <div class="status-badge online" id="status">
                    <div class="status-dot"></div>
                    System Operational
                </div>
            </div>

            <!-- VIEW: DASHBOARD -->
            <div id="view-dashboard" class="view-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Scanned Events</h3>
                        <div class="stat-value accent" id="totalLogs">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Threats Detected</h3>
                        <div class="stat-value danger" id="anomalyCount">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Threat Level</h3>
                        <div class="stat-value warning" id="detectionRate">0%</div>
                    </div>
                    <div class="stat-card">
                        <h3>Knowledge Base</h3>
                        <div class="stat-value success" id="dbSize">0</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span>üîç</span> Live Event Analysis
                    </div>
                    <div class="card-body">
                        <textarea class="log-input" id="logInput"
                            placeholder="Paste raw security log, syslog, or JSON event here..."></textarea>
                        <button class="btn btn-primary" onclick="analyzeLog()">Scan Event</button>
                        <div id="result"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span></span> Recent Activity
                    </div>
                    <div class="card-body">
                        <table class="alert-table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Event ID</th>
                                    <th>Confidence</th>
                                    <th>Severity</th>
                                    <th>Classification</th>
                                </tr>
                            </thead>
                            <tbody id="dashboardAlertsTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW: ALERTS -->
            <div id="view-alerts" class="view-section">
                <div class="card">
                    <div class="card-header">
                        <span>üö®</span> Threat History
                    </div>
                    <div class="card-body">
                        <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                            <input type="text" class="form-input" placeholder="Search alerts..." style="width: 300px;">
                            <button class="btn btn-primary">Filter</button>
                        </div>
                        <table class="alert-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Log Content</th>
                                    <th>Score</th>
                                    <th>Severity</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="fullAlertsTable">
                                <!-- Populated via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW: ANALYTICS -->
            <div id="view-analytics" class="view-section">
                <div class="analytics-grid">
                    <div class="card">
                        <div class="card-header">Anomaly Trends (24h)</div>
                        <div class="card-body">
                            <div style="height: 300px;">
                                <canvas id="anomalyTrendChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">Attack Types</div>
                        <div class="card-body">
                            <div style="height: 300px;">
                                <canvas id="attackTypeChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">System Performance</div>
                    <div class="card-body">
                        <div style="height: 150px;">
                            <canvas id="perfChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: SETTINGS -->
            <div id="view-settings" class="view-section">
                <div class="card">
                    <div class="card-header"><span>‚öôÔ∏è</span> System Configuration</div>
                    <div class="card-body">
                        <form class="settings-form">
                            <div class="form-group">
                                <label>Anomaly Threshold (%)</label>
                                <input type="range" class="form-input" min="50" max="99" value="90">
                                <div style="text-align: right; color: var(--accent);">90%</div>
                            </div>
                            <div class="form-group">
                                <label>Model Endpoint</label>
                                <input type="text" class="form-input" value="http://localhost:8080/api/detect" readonly>
                            </div>
                            <div class="form-group">
                                <label>Notification Email</label>
                                <input type="email" class="form-input" placeholder="admin@secops.com">
                            </div>
                            <button class="btn btn-primary" type="button">Save Configuration</button>
                        </form>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Navigation Logic
        const tabs = document.querySelectorAll('.nav-item');
        const views = document.querySelectorAll('.view-section');
        const title = document.getElementById('page-title');

        const titles = {
            'dashboard': 'Security Overview',
            'alerts': 'Threat Intelligence',
            'analytics': 'System Analytics',
            'settings': 'Configuration'
        };

        let chartsInitialized = false;
        let trendChart, typeChart, perfChart;

        async function initCharts() {
            if (chartsInitialized) return;

            Chart.defaults.color = '#9E9E9E';
            Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.08)';

            // 1. Anomaly Trends (Line Chart)
            const ctxTrend = document.getElementById('anomalyTrendChart').getContext('2d');
            const gradient = ctxTrend.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(255, 193, 7, 0.4)');
            gradient.addColorStop(1, 'rgba(255, 193, 7, 0.0)');

            trendChart = new Chart(ctxTrend, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', 'Now'],
                    datasets: [{
                        label: 'Anomalies Detected',
                        data: [2, 5, 3, 12, 8, 4, 7], // Placeholder data, will update dynamically
                        borderColor: '#FFC107',
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            // 2. Attack Types (Doughnut Chart)
            const ctxType = document.getElementById('attackTypeChart').getContext('2d');
            typeChart = new Chart(ctxType, {
                type: 'doughnut',
                data: {
                    labels: ['Firewall', 'Auth', 'Endpoint', 'Network', 'Other'],
                    datasets: [{
                        data: [45, 25, 20, 5, 5],
                        backgroundColor: [
                            '#FFC107', // Amber
                            '#FF5722', // Orange
                            '#FF1744', // Red
                            '#00E676', // Green
                            '#9E9E9E'  // Grey
                        ],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { boxWidth: 12 } }
                    },
                    cutout: '70%'
                }
            });

            // 3. System Performance (Bar Chart)
            const ctxPerf = document.getElementById('perfChart').getContext('2d');
            perfChart = new Chart(ctxPerf, {
                type: 'bar',
                data: {
                    labels: ['Latency (ms)', 'Throughput (req/s)', 'CPU (%)', 'Memory (%)'],
                    datasets: [{
                        label: 'Current Metrics',
                        data: [45, 120, 34, 62],
                        backgroundColor: [
                            '#00E676',
                            '#FFC107',
                            '#FF5722',
                            '#2979FF'
                        ],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            chartsInitialized = true;
        }

        // Update charts with real data if available
        async function updateCharts() {
            if (!chartsInitialized) return;

            try {
                // Mocking update logic - in production, fetch from /api/stats endpoint
                // Here we simulate live updates
                const now = new Date();

                // Update Trend Chart (shift data)
                const newDataPoint = Math.floor(Math.random() * 5);
                const labels = trendChart.data.labels;
                const data = trendChart.data.datasets[0].data;

                // Keep only last 7 points
                // In a real app we'd fetch actual history

                trendChart.update();
            } catch (e) { console.error(e); }
        }

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class
                tabs.forEach(t => t.classList.remove('active'));
                views.forEach(v => v.classList.remove('active'));

                // Add active class
                tab.classList.add('active');
                const viewId = `view-${tab.dataset.tab}`;
                document.getElementById(viewId).classList.add('active');

                // Update title
                title.textContent = titles[tab.dataset.tab];

                if (tab.dataset.tab === 'analytics') {
                    // Small delay to ensure DOM is visible for Canvas
                    setTimeout(initCharts, 100);
                }
            });
        });

        // API Integration
        async function fetchStatus() {
            try {
                const res = await fetch('/api/status');
                const data = await res.json();
                document.getElementById('dbSize').textContent = data.vector_db_size;
            } catch (e) { console.error(e); }
        }

        async function fetchStats() {
            try {
                const res = await fetch('/api/stats');
                const data = await res.json();
                document.getElementById('totalLogs').textContent = data.total;
                document.getElementById('anomalyCount').textContent = data.anomalies;
                document.getElementById('detectionRate').textContent =
                    (data.rate * 100).toFixed(1) + '%';
            } catch (e) { console.error(e); }
        }

        async function analyzeLog() {
            const log = document.getElementById('logInput').value;
            if (!log) return;

            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div style="text-align: center; padding: 20px;"><div class="loading" style="margin: 0 auto;"></div><br>Analyzing signature...</div>';

            try {
                const res = await fetch('/api/detect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ log })
                });
                const data = await res.json();

                const scoreBg = data.score > 0.7 ? '#ff0055' : data.score > 0.4 ? '#ffb800' : '#00ff9d';
                const severityClass = data.score > 0.7 ? 'anomaly-critical' : data.score > 0.4 ? 'anomaly-high' : 'anomaly-low';
                const severityText = data.score > 0.7 ? 'CRITICAL' : data.score > 0.4 ? 'SUSPICIOUS' : 'NORMAL';

                resultDiv.innerHTML = `
                    <div class="result-card ${severityClass}">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <small style="color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px;">Threat Score</small>
                                <div class="score-display" style="color: ${scoreBg}">
                                    ${(data.score * 100).toFixed(1)}%
                                </div>
                            </div>
                            <div class="status-badge" style="background: ${scoreBg}20; color: ${scoreBg}; border: 1px solid ${scoreBg}40;">
                                ${severityText} THREAT DETECTED
                            </div>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.2); padding: 16px; border-radius: 8px; margin-bottom: 16px; font-family: monospace;">
                            ${data.log_id}
                        </div>
                        
                        ${data.explanation ? `
                            <p style="font-size: 16px; color: white; margin-bottom: 12px;"><strong>${data.explanation.summary}</strong></p>
                            <p style="color: var(--text-secondary); margin-bottom: 8px;">Recommended Actions:</p>
                            <ul style="padding-left: 20px; color: var(--accent);">
                                ${data.explanation.recommendations.map(r => `<li>${r}</li>`).join('')}
                            </ul>
                        ` : ''}
                    </div>
                `;

                fetchStats();
                fetchAlerts();
            } catch (e) {
                resultDiv.innerHTML = `<div class="result-card anomaly-critical">Error: ${e.message}</div>`;
            }
        }

        async function fetchAlerts() {
            try {
                const res = await fetch('/api/history');
                const data = await res.json();

                // Dashboard table (concise)
                const dbTable = document.getElementById('dashboardAlertsTable');
                const fullTable = document.getElementById('fullAlertsTable');

                const anomalies = data.history.filter(h => h.is_anomaly).slice().reverse();

                // Update Dashboard Table (Max 5)
                dbTable.innerHTML = anomalies.slice(0, 5).map(alert => {
                    const sev = alert.score > 0.7 ? 'Critical' : 'High';
                    const sevClass = alert.score > 0.7 ? 'severity-critical' : 'severity-high';
                    return `
                    <tr>
                        <td style="color: var(--text-secondary)">${new Date().toLocaleTimeString()}</td>
                        <td style="font-family: monospace">${alert.log_id.substring(0, 8)}...</td>
                        <td>${(alert.score * 100).toFixed(0)}%</td>
                        <td><span class="severity-badge ${sevClass}">${sev}</span></td>
                        <td>${alert.explanation?.summary.split('.')[0] || 'Anomaly detected'}</td>
                    </tr>
                    `;
                }).join('');

                // Update Alerts Tab Table (Full)
                fullTable.innerHTML = anomalies.map(alert => {
                    const sev = alert.score > 0.7 ? 'Critical' : 'High';
                    const sevClass = alert.score > 0.7 ? 'severity-critical' : 'severity-high';
                    return `
                    <tr>
                        <td>${new Date().toLocaleTimeString()}</td>
                        <td style="max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-secondary);">
                            ${alert.cleaned_log || 'N/A'}
                        </td>
                        <td style="color: var(--accent); font-weight: bold;">${(alert.score * 100).toFixed(1)}%</td>
                        <td><span class="severity-badge ${sevClass}">${sev}</span></td>
                        <td><button class="btn" style="padding: 4px 8px; font-size: 12px; background: var(--bg-primary); border: 1px solid var(--border);">Inspect</button></td>
                    </tr>
                    `;
                }).join('');

            } catch (e) { console.error(e); }
        }

        // Initial load
        fetchStatus();
        fetchStats();
        fetchAlerts();
        setInterval(() => {
            fetchStats();
            if (chartsInitialized) updateCharts();
        }, 5000);
    </script>
</body>

</html>